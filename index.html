<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mini Compiler (HTML/CSS/JS)</title>
  <style>
    :root { color-scheme: light dark; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    header {
      display: flex; gap: 12px; align-items: center; justify-content: space-between;
      padding: 12px 14px; border-bottom: 1px solid #ccc;
    }
    header .left { display: flex; gap: 10px; align-items: center; }
    button {
      padding: 8px 12px; border: 1px solid #888; border-radius: 10px;
      background: transparent; cursor: pointer;
    }
    button:hover { opacity: 0.85; }
    .wrap { display: grid; grid-template-columns: 1fr 1fr; height: calc(100vh - 58px); }
    .editors {
      display: grid; grid-template-rows: 1fr 1fr 1fr;
      border-right: 1px solid #ccc; min-width: 0;
    }
    .panel { display: grid; grid-template-rows: auto 1fr; min-height: 0; }
    .panel h3 {
      margin: 0; padding: 8px 12px; font-size: 14px; border-bottom: 1px solid #ccc;
    }
    textarea {
      width: 100%; height: 100%; resize: none; border: 0; outline: none;
      padding: 10px 12px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size: 13px; line-height: 1.35; box-sizing: border-box;
    }
    .preview { min-width: 0; display: grid; grid-template-rows: auto 1fr; }
    .status {
      padding: 8px 12px; border-bottom: 1px solid #ccc; font-size: 13px;
      display: flex; gap: 12px; align-items: center; justify-content: space-between;
    }
    iframe { width: 100%; height: 100%; border: 0; background: white; }
    .small { font-size: 12px; opacity: 0.75; }
    label { display: inline-flex; align-items: center; gap: 6px; cursor: pointer; }
    @media (max-width: 900px) {
      .wrap { grid-template-columns: 1fr; grid-template-rows: 1fr 1fr; }
      .editors { border-right: 0; border-bottom: 1px solid #ccc; }
    }
  </style>
</head>
<body>
  <header>
    <div class="left">
      <strong>Mini Compiler</strong>
      <span class="small">HTML / CSS / JS ‚Üí Preview</span>
    </div>
    <div class="right">
      <label title="–ê–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏ –≤–≤–æ–¥—ñ">
        <input id="autoRun" type="checkbox" checked />
        Auto-run
      </label>
      <button id="runBtn">Run ‚ñ∂</button>
      <button id="resetBtn" title="–ü–æ–≤–µ—Ä–Ω—É—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥">Reset</button>
    </div>
  </header>

  <div class="wrap">
    <div class="editors">
      <section class="panel">
        <h3>HTML</h3>
        <textarea id="html"></textarea>
      </section>
      <section class="panel">
        <h3>CSS</h3>
        <textarea id="css"></textarea>
      </section>
      <section class="panel">
        <h3>JavaScript</h3>
        <textarea id="js"></textarea>
      </section>
    </div>

    <div class="preview">
      <div class="status">
        <span id="msg">–ì–æ—Ç–æ–≤–æ.</span>
        <span class="small">–ü–æ—Ä–∞–¥–∞: Ctrl/‚åò + Enter = Run</span>
      </div>
      <iframe id="out" sandbox="allow-scripts allow-forms allow-modals allow-popups"></iframe>
    </div>
  </div>

  <script>
    const htmlEl = document.getElementById("html");
    const cssEl  = document.getElementById("css");
    const jsEl   = document.getElementById("js");
    const out    = document.getElementById("out");
    const msg    = document.getElementById("msg");
    const autoRun = document.getElementById("autoRun");

    const starter = {
      html: `<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Demo</title>
  </head>
  <body>
    <h1>–ü—Ä–∏–≤—ñ—Ç üëã</h1>
    <p>–¶–µ –º—ñ–Ω—ñ-–∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä —É –±—Ä–∞—É–∑–µ—Ä—ñ.</p>
    <button id="btn">–ù–∞—Ç–∏—Å–Ω–∏ –º–µ–Ω–µ</button>
  </body>
</html>`,
      css: `body { font-family: system-ui, sans-serif; padding: 24px; }
h1 { margin: 0 0 10px; }
button { padding: 10px 14px; border-radius: 10px; border: 1px solid #888; }`,
      js: `document.getElementById("btn").addEventListener("click", () => {
  alert("–ü—Ä–∞—Ü—é—î! ‚úÖ");
});`
    };

    function buildDoc() {
      // –ó–±–∏—Ä–∞—î–º–æ –ø–æ–≤–Ω–∏–π HTML-–¥–æ–∫—É–º–µ–Ω—Ç —É srcdoc
      const html = htmlEl.value || "";
      const css  = cssEl.value || "";
      const js   = jsEl.value || "";

      // –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—Å—Ç–∞–≤–∏–≤ –ø–æ–≤–Ω–∏–π –¥–æ–∫—É–º–µ–Ω—Ç ‚Äî –ø—Ä–æ—Å—Ç–æ –¥–æ–ø–æ–≤–Ω–∏–º–æ —Å—Ç–∏–ª–µ–º —ñ —Å–∫—Ä–∏–ø—Ç–æ–º
      // –Ø–∫—â–æ –Ω—ñ ‚Äî –∑–∞–≥–æ—Ä–Ω–µ–º–æ –≤ –±–∞–∑–æ–≤—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É.
      const looksLikeFullDoc = /<html[\s>]/i.test(html) || /<!doctype/i.test(html);

      if (looksLikeFullDoc) {
        // –í—Å—Ç–∞–≤–ª—è—î–º–æ CSS –ø–µ—Ä–µ–¥ </head>, –∞ JS –ø–µ—Ä–µ–¥ </body> —è–∫—â–æ –º–æ–∂–ª–∏–≤–æ
        let doc = html;

        if (css.trim()) {
          if (/<\/head>/i.test(doc)) doc = doc.replace(/<\/head>/i, `<style>${css}</style></head>`);
          else doc = `<style>${css}</style>\n` + doc;
        }

        if (js.trim()) {
          if (/<\/body>/i.test(doc)) doc = doc.replace(/<\/body>/i, `<script>${js}<\/script></body>`);
          else doc += `\n<script>${js}<\/script>`;
        }

        return doc;
      }

      // –Ø–∫—â–æ HTML ‚Äî —Ü–µ –ª–∏—à–µ —à–º–∞—Ç–æ–∫ —Ä–æ–∑–º—ñ—Ç–∫–∏
      return `<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>${css}</style>
  </head>
  <body>
    ${html}
    <script>${js}<\/script>
  </body>
</html>`;
    }

    function run() {
      const doc = buildDoc();
      out.srcdoc = doc;
      msg.textContent = "–ó–∞–ø—É—â–µ–Ω–æ ‚úÖ";
      setTimeout(() => (msg.textContent = "–ì–æ—Ç–æ–≤–æ."), 800);
    }

    function reset() {
      htmlEl.value = starter.html;
      cssEl.value = starter.css;
      jsEl.value = starter.js;
      run();
    }

    // –ê–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∑ –Ω–µ–≤–µ–ª–∏–∫–∏–º debounce
    let t = null;
    function scheduleRun() {
      if (!autoRun.checked) return;
      clearTimeout(t);
      t = setTimeout(run, 250);
    }

    document.getElementById("runBtn").addEventListener("click", run);
    document.getElementById("resetBtn").addEventListener("click", reset);

    [htmlEl, cssEl, jsEl].forEach(el => el.addEventListener("input", scheduleRun));

    // Ctrl/‚åò + Enter
    window.addEventListener("keydown", (e) => {
      const isEnter = e.key === "Enter";
      const mod = e.ctrlKey || e.metaKey;
      if (mod && isEnter) {
        e.preventDefault();
        run();
      }
    });

    // –°—Ç–∞—Ä—Ç
    reset();
  </script>
</body>
</html>
